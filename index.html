<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Olivetonomics – Lean Startup Simulation</title>
  <style>
    :root { --bg:#0b1220;--panel:#121a2a;--muted:#9fb3c8;--text:#e6eef8;--accent:#70b5ff;--ok:#6ee7a6;--bad:#ff9aa8; }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
    header{padding:22px;border-bottom:1px solid #22304a;background:linear-gradient(180deg,#101a2d,#0b1220)}
    h1{margin:0;font-size:24px;font-weight:600}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    .card{background:var(--panel);border:1px solid #22304a;border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
    label{display:block;margin:8px 0 4px;color:var(--muted);font-size:14px}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3b59;background:#0e1626;color:var(--text)}
    textarea{resize:vertical;min-height:120px}
    .btn{border:1px solid #2b3b59;background:#0e1626;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;transition:0.15s}
    .btn:hover{border-color:#3a4f78;background:#152238}
    .accent{background:#132542;border-color:#1b3966;color:var(--accent)}
    .muted{color:var(--muted)} .ok{color:var(--ok)} .bad{color:var(--bad)}
    .foot{margin-top:10px;display:flex;gap:10px;justify-content:flex-end}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px 10px;border-bottom:1px solid #22304a;text-align:right}
    th:first-child,td:first-child{text-align:left}
    tfoot td{font-weight:600}
    #loaderOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);color:var(--accent);display:none;align-items:center;justify-content:center;flex-direction:column;font-family:monospace;font-size:20px;z-index:9999;}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Olivetonomics <span style="font-size:14px;color:var(--muted)">Agile Market Simulation</span></h1>
    <div class="muted">Now with monthly cycles, cash runway, and typewriter-style event loader.</div>
  </div>
</header>

<div id="loaderOverlay"><div id="loaderText"></div></div>

<main class="wrap grid">
  <section class="card">
    <h2>Setup</h2>
    <label>Company name</label><input id="company" placeholder="e.g., Campus Coffee Co." />
    <label>Months to simulate</label><input id="months" type="number" value="12" min="3" max="24" />
    <label>Starting cash ($)</label><input id="startCash" type="number" value="5000" />
    <div class="foot">
      <button class="btn accent" onclick="startGame()">Start Simulation</button>
      <button class="btn" onclick="resetAll()">Reset</button>
    </div>
  </section>

  <section class="card">
    <h2>Controls</h2>
    <div id="controls" class="muted">Press “Start Simulation”.</div>
    <div id="cashBar" class="muted" style="margin-top:8px"></div>
  </section>

  <section class="card" style="grid-column:1/3">
    <h2>Results</h2>
    <table id="table">
      <thead><tr><th>Month</th><th>ΔPrice%</th><th>Marketing$</th><th>Training$</th><th>Event</th><th>Demand</th><th>Revenue$</th><th>Cost$</th><th>Profit$</th><th>Cash$</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td colspan="10" class="muted">No data yet.</td></tr></tfoot>
    </table>
    <div class="foot">
      <button class="btn" onclick="exportCSV()">Export Results (CSV)</button>
    </div>
  </section>
</main>

<script>
const state={started:false,month:0,maxMonths:3,rows:[],cash:0};
function startGame(){
  state.maxMonths=parseInt(document.getElementById('months').value)||12;
  state.month=0;state.rows=[];
  state.started=true;
  state.cash=parseFloat(document.getElementById('startCash').value)||5000;
  buildControls();renderTable();updateCashBar();
}
function resetAll(){location.reload();}
function buildControls(){
  const c=document.getElementById('controls');
  if(!state.started){c.textContent='Press “Start Simulation”.';return;}
  const disabled=state.month>=state.maxMonths;
  c.innerHTML=`<div class="row">
    <div><label>ΔPrice%</label><input id="dPrice" type="number" value="0" ${disabled?'disabled':''}></div>
    <div><label>Marketing$</label><input id="mkt" type="number" value="500" ${disabled?'disabled':''}></div>
    <div><label>Training$</label><input id="train" type="number" value="300" ${disabled?'disabled':''}></div>
  </div>
  <div class="foot"><button class="btn accent" ${disabled?'disabled':''} onclick="runMonth()">Run Month ${state.month+1}</button></div>`;
}
function updateCashBar(){
  document.getElementById('cashBar').innerHTML=`Cash: <b>${fmt(state.cash)}</b>`;
}
function runMonth(){
  showLoader(['Processing market data...','Calculating sales...','Analysing competitors...','Applying event...']);
  setTimeout(()=>{simulate();hideLoader();},3000);
}
function simulate(){
  const company=document.getElementById('company').value.trim();
  const dPrice=parseFloat(document.getElementById('dPrice').value)||0;
  const mSpend=parseFloat(document.getElementById('mkt').value)||0;
  const tSpend=parseFloat(document.getElementById('train').value)||0;
  const events=['Competitor discount','Local buzz','Supply hiccup','Holiday surge','Normal'];
  const event=events[Math.floor(Math.random()*events.length)];
  let demand=120*(1-(dPrice/100)*0.5)+(Math.random()*10-5);
  if(event==='Local buzz')demand*=1.1;
  if(event==='Competitor discount')demand*=0.9;
  if(event==='Holiday surge')demand*=1.15;
  const price=10*(1+dPrice/100);
  const revenue=price*demand;
  const cost=4*demand+mSpend+tSpend;
  const profit=revenue-cost;
  state.cash+=profit;
  state.rows.push({
    company,month:state.month+1,dPrice,mSpend,tSpend,event,
    demand:Math.round(demand),revenue,cost,profit,cash:state.cash
  });
  state.month++;
  buildControls();renderTable();updateCashBar();
}
function renderTable(){
  const tb=document.querySelector('#table tbody');
  const tf=document.querySelector('#table tfoot tr td');
  tb.innerHTML='';
  if(state.rows.length===0){tf.textContent='No data yet.';return;}
  tf.textContent='';
  for(const r of state.rows){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.month}</td>
      <td>${r.dPrice}%</td>
      <td>${fmt(r.mSpend)}</td>
      <td>${fmt(r.tSpend)}</td>
      <td class='muted'>${r.event}</td>
      <td>${r.demand}</td>
      <td>${fmt(r.revenue)}</td>
      <td>${fmt(r.cost)}</td>
      <td class='${r.profit>=0?'ok':'bad'}'>${fmt(r.profit)}</td>
      <td class='${r.cash<0?'bad':''}'>${fmt(r.cash)}</td>`;
    tb.appendChild(tr);
  }
  tf.textContent=`Months completed ${state.rows.length}/${state.maxMonths}.`;
}
function fmt(n){return '$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}
function showLoader(lines){
  const overlay=document.getElementById('loaderOverlay');
  const loader=document.getElementById('loaderText');
  overlay.style.display='flex';loader.textContent='';
  let i=0;
  function type(){
    if(i<lines.length){
      loader.textContent+=lines[i]+'\\n';
      i++;
      setTimeout(type,600);
    }
  }
  type();
}
function hideLoader(){
  setTimeout(()=>{document.getElementById('loaderOverlay').style.display='none';},2000);
}
function exportCSV() {
  if (state.rows.length === 0) return;
  const headers = ['month','delta_price_pct','marketing','training','event','demand','revenue','cost','profit','cash'];
  const company = (state.rows[0]?.company || document.getElementById('company').value || 'olivetonomics')
                    .replace(/[^a-z0-9]/gi, '_');
  const now = new Date();
  const timestamp = now.toISOString().replace('T', ' ').substring(0, 19);
  const metadata = [
    `Company:,${company}`,
    `Exported:,${timestamp}`
  ];
  const lines = metadata
    .concat([''])
    .concat([headers.join(',')])
    .concat(state.rows.map(r =>
      [r.month, r.dPrice, r.mSpend, r.tSpend, `"${r.event}"`, r.demand,
       r.revenue.toFixed(2), r.cost.toFixed(2), r.profit.toFixed(2), r.cash.toFixed(2)].join(',')
    ));
  const blob = new Blob([lines.join('\\n')], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${company}_results.csv`;
  a.click();
}
</script>
</body>
</html>
