<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Olivetonomics ‚Äì Lean Startup Simulation</title>
  <style>
    :root { --bg:#0b1220;--panel:#121a2a;--muted:#9fb3c8;--text:#e6eef8;--accent:#70b5ff;--ok:#6ee7a6;--bad:#ff9aa8; }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
    header{padding:22px;border-bottom:1px solid #22304a;background:linear-gradient(180deg,#101a2d,#0b1220)}
    h1{margin:0;font-size:24px;font-weight:600}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    .card{background:var(--panel);border:1px solid #22304a;border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
    label{display:block;margin:8px 0 4px;color:var(--muted);font-size:14px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3b59;background:#0e1626;color:var(--text)}
    .btn{border:1px solid #2b3b59;background:#0e1626;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;transition:0.15s}
    .btn:hover{border-color:#3a4f78;background:#152238}
    .accent{background:#132542;border-color:#1b3966;color:var(--accent)}
    .muted{color:var(--muted)} .ok{color:var(--ok)} .bad{color:var(--bad)}
    .foot{margin-top:10px;display:flex;gap:10px;justify-content:flex-end}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px 10px;border-bottom:1px solid #22304a;text-align:right}
    th:first-child,td:first-child{text-align:left}
    tfoot td{font-weight:600}

    /* Loader overlay */
    #loaderOverlay{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,.93);color:var(--accent);
      display:none;align-items:center;justify-content:center;flex-direction:column;
      font-family:monospace;font-size:18px;z-index:9999;text-align:center;padding:20px;
    }
    .spinner{
      border:4px solid #22304a;border-top:4px solid var(--accent);
      border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;margin-bottom:16px;
    }
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

    #loaderText{white-space:pre-line;min-height:80px;}
    #eventReveal{
      margin-top:14px;font-size:26px;font-weight:700;color:#bfe0ff;
      text-shadow:0 0 12px rgba(112,181,255,.9);
      opacity:0;transform:scale(.96);
      transition:opacity .5s ease, transform .5s ease;
    }
    #eventReveal.pulse{
      animation:pulse 1.8s ease-in-out infinite alternate;
    }
    #eventSub{
      margin-top:6px;font-size:16px;color:var(--muted);
      opacity:0;transition:opacity 0.6s ease;
    }
    @keyframes pulse {
      0%{text-shadow:0 0 6px rgba(112,181,255,.5)}
      100%{text-shadow:0 0 20px rgba(112,181,255,1)}
    }

    #continueBtn{
      margin-top:18px;padding:10px 22px;font-size:16px;border-radius:10px;
      background:#132542;border:1px solid #1b3966;color:var(--accent);
      cursor:pointer;display:none;transition:0.2s;
      box-shadow:0 0 8px rgba(112,181,255,.35);
    }
    #continueBtn:hover{background:#1b3966;color:#fff;box-shadow:0 0 12px rgba(112,181,255,.6)}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Olivetonomics <span style="font-size:14px;color:var(--muted)">Agile Market Simulation ‚Äì 24 Months</span></h1>
    <div class="muted">Animated loader synced with event data.  Try not to bankrupt your startup!</div>
  </div>
</header>

<div id="loaderOverlay">
  <div class="spinner"></div>
  <div id="loaderText"></div>
  <div id="eventReveal"></div>
  <div id="eventSub"></div>
  <button id="continueBtn">Continue</button>
</div>

<main class="wrap grid">
  <section class="card">
    <h2>Setup</h2>
    <label>Company name</label><input id="company" placeholder="e.g., Campus Coffee Co." />
    <label>Months to simulate</label><input id="months" type="number" value="24" min="6" max="36" />
    <label>Starting cash ($)</label><input id="startCash" type="number" value="5000" />
    <div class="foot">
      <button class="btn accent" onclick="startGame()">Start Simulation</button>
      <button class="btn" onclick="resetAll()">Reset</button>
    </div>
  </section>

  <section class="card">
    <h2>Controls</h2>
    <div id="controls" class="muted">Press ‚ÄúStart Simulation‚Äù.</div>
    <div id="cashBar" class="muted" style="margin-top:8px"></div>
  </section>

  <section class="card" style="grid-column:1/3">
    <h2>Results</h2>
    <table id="table">
      <thead>
        <tr><th>Month</th><th>ŒîPrice%</th><th>Marketing$</th><th>Training$</th><th>Event</th><th>Demand</th><th>Revenue$</th><th>Cost$</th><th>Profit$</th><th>Cash$</th></tr>
      </thead>
      <tbody></tbody>
      <tfoot><tr><td colspan="10" class="muted">No data yet.</td></tr></tfoot>
    </table>
    <div class="foot"><button class="btn" onclick="exportCSV()">Export CSV</button></div>
  </section>
</main>

<script>
const state={started:false,month:0,maxMonths:24,rows:[],cash:0,pendingEvent:null,loaderMode:'intro'};
const EVENTS=[
  {name:'Competitor Discount',emoji:'‚ö†Ô∏è',effect:'Customers flock to cheaper rival',dMult:0.9},
  {name:'Local Buzz',emoji:'üéâ',effect:'Word of mouth boosts your brand',dMult:1.1},
  {name:'Supply Hiccup',emoji:'üì¶',effect:'Stock delays hurt sales',dMult:0.95},
  {name:'Holiday Surge',emoji:'üåü',effect:'Seasonal demand spike increases traffic',dMult:1.15},
  {name:'Normal Month',emoji:'üíº',effect:'Stable market conditions',dMult:1.0}
];
function startGame(){state.maxMonths=parseInt(val('#months'))||24;state.cash=parseFloat(val('#startCash'))||5000;state.month=0;state.rows=[];state.started=true;buildControls();renderTable();updateCashBar();showIntroLoader();}
function resetAll(){location.reload();}
function val(sel){return document.querySelector(sel).value.trim();}
function num(sel){return parseFloat(val(sel))||0;}
function buildControls(){const c=document.getElementById('controls');if(!state.started){c.textContent='Press ‚ÄúStart Simulation‚Äù.';return;}const dis=state.month>=state.maxMonths;c.innerHTML=`<div><label>ŒîPrice%</label><input id="dPrice" type="number" value="0" ${dis?'disabled':''}></div><div><label>Marketing$</label><input id="mkt" type="number" value="500" ${dis?'disabled':''}></div><div><label>Training$</label><input id="train" type="number" value="300" ${dis?'disabled':''}></div><div class="foot"><button class="btn accent" ${dis?'disabled':''} onclick="runMonth()">Run Month ${state.month+1}</button></div>`;}
function updateCashBar(){document.getElementById('cashBar').innerHTML=`Cash: <b>${fmt(state.cash)}</b>`;}
function runMonth(){state.pendingEvent=EVENTS[Math.floor(Math.random()*EVENTS.length)];const mLabel=state.month+1;const lines=[`Processing Month ${mLabel}...`,`Calculating revenue and costs...`,`Updating employee morale...`,`Analysing competition...`,`Applying market event...`];showProcessingLoader(lines,state.pendingEvent);}
function simulateWithEvent(e){const dPrice=num('#dPrice');const m=num('#mkt');const t=num('#train');let demand=120*(1-(dPrice/100)*0.5)+(Math.random()*10-5);demand*=e.dMult;const price=10*(1+dPrice/100);const revenue=price*demand;const cost=4*demand+m+t;const profit=revenue-cost;state.cash+=profit;state.rows.push({company:val('#company')||'Startup',month:state.month+1,dPrice,mSpend:m,tSpend:t,event:`${e.emoji} ${e.name}`,demand:Math.round(demand),revenue,cost,profit,cash:state.cash});state.month++;buildControls();renderTable();updateCashBar();if(state.month>=state.maxMonths)showEndLoader();}
function renderTable(){const tb=document.querySelector('#table tbody');const tf=document.querySelector('#table tfoot tr td');tb.innerHTML='';if(!state.rows.length){tf.textContent='No data yet.';return;}tf.textContent='';for(const r of state.rows){const tr=document.createElement('tr');tr.innerHTML=`<td>${r.month}</td><td>${r.dPrice}%</td><td>${fmt(r.mSpend)}</td><td>${fmt(r.tSpend)}</td><td>${r.event}</td><td>${r.demand}</td><td>${fmt(r.revenue)}</td><td>${fmt(r.cost)}</td><td class="${r.profit>=0?'ok':'bad'}">${fmt(r.profit)}</td><td class="${r.cash<0?'bad':''}">${fmt(r.cash)}</td>`;tb.appendChild(tr);}tf.textContent=`Months completed ${state.rows.length}/${state.maxMonths}.`;}
function fmt(n){return '$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}

/* Loader logic */
const overlay=document.getElementById('loaderOverlay');const loaderText=document.getElementById('loaderText');const eventReveal=document.getElementById('eventReveal');const eventSub=document.getElementById('eventSub');const continueBtn=document.getElementById('continueBtn');
continueBtn.onclick=()=>{if(state.loaderMode==='intro')hideLoader();else if(state.loaderMode==='month'){simulateWithEvent(state.pendingEvent);hideLoader();state.pendingEvent=null;}else if(state.loaderMode==='end')hideLoader();};
function showIntroLoader(){state.loaderMode='intro';overlay.style.display='flex';loaderText.innerHTML='';eventReveal.style.opacity=0;eventSub.style.opacity=0;continueBtn.style.display='none';typeLines(['Initializing Olivetonomics systems...','Seeding market data...','Loading analytics modules...','Ready.'],()=>{eventReveal.innerHTML='Press Continue to begin Month 1.';eventReveal.style.opacity=1;eventReveal.classList.add('pulse');continueBtn.style.display='inline-block';});}
function showProcessingLoader(lines,e){state.loaderMode='month';overlay.style.display='flex';loaderText.innerHTML='';eventReveal.style.opacity=0;eventSub.style.opacity=0;continueBtn.style.display='none';typeLines(lines,()=>{eventReveal.innerHTML=`${e.emoji} ${e.name}!`;eventSub.innerHTML=e.effect;eventReveal.style.opacity=1;eventReveal.classList.add('pulse');eventSub.style.opacity=1;setTimeout(()=>{continueBtn.textContent='Continue';continueBtn.style.display='inline-block';},800);});}
function showEndLoader(){state.loaderMode='end';overlay.style.display='flex';loaderText.innerHTML='';eventReveal.innerHTML='üíº Fiscal Year Complete';eventSub.innerHTML='Export your results and decide whether to Pivot or Persevere.';eventReveal.style.opacity=1;eventReveal.classList.add('pulse');eventSub.style.opacity=1;continueBtn.textContent='Close';continueBtn.style.display='inline-block';}
function typeLines(lines,done){let i=0;function step(){if(i<lines.length){loaderText.innerHTML+=lines[i]+'<br>';i++;setTimeout(step,600);}else done&&done();}step();}
function hideLoader(){overlay.style.display='none';}

/* Export CSV */
function exportCSV(){if(!state.rows.length)return;const headers=['company','month','delta_price_pct','marketing','training','event','demand','revenue','cost','profit','cash'];const company=(state.rows[0]?.company||'Olivetonomics').replace(/[^a-z0-9]/gi,'_');const now=new Date();const timestamp=now.toISOString().replace('T',' ').substring(0,19);const meta=[`Company:,${company}`,`Exported:,${timestamp}`,''];const lines=[headers.join(',')].concat(state.rows.map(r=>[`"${r.company}"`,r.month,r.dPrice,r.mSpend,r.tSpend,`"${r.event}"`,r.demand,r.revenue.toFixed(2),r.cost.toFixed(2),r.profit.toFixed(2),r.cash.toFixed(2)].join(',')));const blob=new Blob([meta.join('\n')+'\n'+lines.join('\n')],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`${company}_results.csv`;a.click();}
</script>
</body>
</html>
