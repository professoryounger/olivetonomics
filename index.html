<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Olivetonomics – Lean Startup Mini‑Sim</title>
  <style>
    :root {
      --bg: #0b1220; --panel:#121a2a; --muted:#9fb3c8; --text:#e6eef8; --accent:#70b5ff; --ok:#6ee7a6; --bad:#ff9aa8;
    }
    *{box-sizing:border-box} body{margin:0;font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:var(--bg)}
    header{padding:22px;border-bottom:1px solid #22304a;background:linear-gradient(180deg,#101a2d,#0b1220)}
    h1{margin:0;font-size:24px;font-weight:600}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    .card{background:var(--panel);border:1px solid #22304a;border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
    label{display:block;margin:8px 0 4px;color:var(--muted);font-size:14px}
    input, select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3b59;background:#0e1626;color:var(--text)}
    textarea{resize:vertical;min-height:120px}
    input[type=number]{appearance:textfield}
    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}
    .btn{border:1px solid #2b3b59;background:#0e1626;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;transition:0.15s}
    .btn:hover{border-color:#3a4f78;background:#152238}
    .accent{background:#132542;border-color:#1b3966;color:var(--accent)}
    .pill{display:inline-block;padding:2px 10px;border-radius:999px;border:1px solid #2b3b59;color:var(--muted);font-size:12px;margin-left:6px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th, td{padding:8px 10px;border-bottom:1px solid #22304a;text-align:right}
    th:first-child, td:first-child{text-align:left}
    tfoot td{font-weight:600}
    .muted{color:var(--muted)}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .hint{font-size:13px;color:var(--muted)}
    .foot{margin-top:10px;display:flex;gap:10px;justify-content:flex-end}
    .tag{font-size:12px;color:#c8e2ff;background:#0e2542;border:1px solid #214d86;border-radius:999px;padding:2px 8px;margin-right:6px}
    .stack{display:flex;flex-direction:column;gap:8px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Olivetonomics <span class="pill">Build → Measure → Learn</span></h1>
      <div class="hint">Experience agile decision‑making through three quick sprints.  Adjust prices, marketing, and training to see how your choices shape performance.</div>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card">
      <h2 style="margin:4px 0 8px">Setup</h2>
      <div class="row">
        <div>
          <label>Company name</label>
          <input id="company" placeholder="e.g., Campus Coffee Co." />
        </div>
        <div>
          <label>Primary metric</label>
          <select id="metric">
            <option value="profit">Net Profit</option>
            <option value="satisfaction">Customer Satisfaction</option>
            <option value="efficiency">Production Efficiency</option>
          </select>
        </div>
      </div>
      <label>Value hypothesis</label>
      <textarea id="hypo" placeholder="If we invest in staff training and local marketing, customer satisfaction and sales volume will increase within three rounds."></textarea>

      <div class="row">
        <div>
          <label>Base price ($)</label>
          <input id="basePrice" type="number" value="10" />
        </div>
        <div>
          <label>Unit cost ($)</label>
          <input id="unitCost" type="number" value="4" />
        </div>
        <div>
          <label>Starting demand (units)</label>
          <input id="baseDemand" type="number" value="120" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Price elasticity (‑0.4 to ‑2.0)</label>
          <input id="elasticity" type="number" value="-1.0" step="0.1" />
        </div>
        <div>
          <label>Marketing responsiveness (0‑1)</label>
          <input id="mkResp" type="number" value="0.3" step="0.05" />
        </div>
        <div>
          <label>Training responsiveness (0‑1)</label>
          <input id="trResp" type="number" value="0.25" step="0.05" />
        </div>
      </div>

      <div class="foot">
        <button class="btn accent" onclick="startGame()">Start Simulation</button>
        <button class="btn" onclick="resetAll()">Reset</button>
      </div>
    </section>

    <section class="card">
      <h2 style="margin:4px 0 8px">Round Controls</h2>
      <div id="controls" class="stack">
        <div class="muted">Click “Start Simulation” to unlock controls.</div>
      </div>
    </section>

    <section class="card" style="grid-column:1/3">
      <h2 style="margin:4px 0 8px">Results</h2>
      <div class="hint">Each round simulates a sprint.  Random market events may appear, just like real‑world surprises.</div>
      <div class="row">
        <div>
          <label>Random seed</label>
          <input id="seed" value="42" />
        </div>
        <div class="row" style="justify-content:flex-end;gap:8px">
          <button class="btn" onclick="exportCSV()">Export CSV</button>
          <button class="btn" onclick="copyReport()">Copy Pivot/Persevere Summary</button>
        </div>
      </div>

      <table id="table">
        <thead>
          <tr>
            <th>Round</th><th>ΔPrice %</th><th>Marketing $</th><th>Training $</th><th>Event</th><th>Demand</th><th>Revenue $</th><th>Cost $</th><th>Profit $</th><th>Satisfaction</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr><td colspan="10" class="muted">No data yet.</td></tr>
        </tfoot>
      </table>
    </section>
  </main>

  <script>
    function xmur3(str){for(var i=0,h=1779033703^str.length;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909);return (h^h>>>16)>>>0};}
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296;}}

    const state = { started:false, round:0, maxRounds:3, params:{}, rows:[] };

    function startGame(){
      state.params = {
        company: val('#company')||'My Startup', metric: val('#metric'), hypo: val('#hypo'),
        basePrice: num('#basePrice'), unitCost: num('#unitCost'), baseDemand: num('#baseDemand'),
        elasticity: num('#elasticity'), mkResp: num('#mkResp'), trResp: num('#trResp'),
      };
      state.round=0; state.rows=[]; state.started=true;
      buildControls(); renderTable();
    }
    function resetAll(){ location.reload(); }
    function val(sel){return document.querySelector(sel).value.trim();}
    function num(sel){return parseFloat(val(sel))||0;}

    function buildControls(){
      const c = document.getElementById('controls');
      if(!state.started){ c.innerHTML = '<div class="muted">Click “Start Simulation” to unlock controls.</div>'; return; }
      const disabled = state.round>=state.maxRounds;
      c.innerHTML = `
        <div class="row">
          <div><label>Change price (Δ%)</label><input id="dPrice" type="number" value="0" ${disabled?'disabled':''} /></div>
          <div><label>Marketing spend ($)</label><input id="mkt" type="number" value="500" ${disabled?'disabled':''} /></div>
          <div><label>Training spend ($)</label><input id="train" type="number" value="300" ${disabled?'disabled':''} /></div>
        </div>
        <div class="foot"><button class="btn ${disabled?'':'accent'}" ${disabled?'disabled':''} onclick="runRound()">Run Round ${state.round+1}</button></div>`;
    }

    function eventFor(rng){
      const roll = rng();
      if(roll < 0.15) return {name:'Competitor discount', demandMult:0.9, satDelta:-3};
      if(roll < 0.30) return {name:'Local buzz', demandMult:1.1, satDelta:+2};
      if(roll < 0.40) return {name:'Supply hiccup', demandMult:0.95, satDelta:-1};
      if(roll < 0.50) return {name:'Holiday surge', demandMult:1.15, satDelta:+1};
      return {name:'Normal', demandMult:1.0, satDelta:0};
    }

    function runRound(){
      if(state.round>=state.maxRounds) return;
      const seedStr = document.getElementById('seed').value || '42';
      const rng = mulberry32(xmur3(seedStr)());
      const p = state.params;
      const dPrice = num('#dPrice');
      const mSpend = Math.max(0, num('#mkt'));
      const tSpend = Math.max(0, num('#train'));

      const price = p.basePrice * (1 + dPrice/100);
      let demand = Math.max(0, p.baseDemand * (1 + p.elasticity * (dPrice/100)));
      demand *= (1 + p.mkResp * Math.tanh(mSpend/1000));

      let satisfaction = 50 + (p.trResp * Math.tanh(tSpend/800) * 40) - (dPrice>0 ? Math.min(dPrice,20)*0.6 : 0);
      const ev = eventFor(rng);
      demand *= ev.demandMult; satisfaction += ev.satDelta;
      demand = Math.round(demand); satisfaction = Math.max(0, Math.min(100, Math.round(satisfaction)));

      const revenue = price * demand;
      const productCost = p.unitCost * demand;
      const opex = mSpend + tSpend;
      const profit = Math.round((revenue - productCost - opex) * 100)/100;

      state.rows.push({ round: state.round+1, dPrice, mSpend, tSpend, event: ev.name, demand, price: Math.round(price*100)/100, revenue: Math.round(revenue*100)/100, cost: Math.round((productCost+opex)*100)/100, profit, satisfaction });
      state.round++; buildControls(); renderTable();
    }

    function renderTable(){
      const tb = document.querySelector('#table tbody');
      const tf = document.querySelector('#table tfoot tr td');
      tb.innerHTML = '';
      if(state.rows.length===0){ tf.textContent = 'No data yet.'; return; }
      tf.textContent = '';
      for(const r of state.rows){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.round}</td><td>${fmtPct(r.dPrice)}</td><td>${fmt(r.mSpend)}</td><td>${fmt(r.tSpend)}</td><td class="muted">${r.event}</td><td>${r.demand}</td><td>${fmt(r.revenue)}</td><td>${fmt(r.cost)}</td><td class="${r.profit>=0?'ok':'bad'}">${fmt(r.profit)}</td><td>${r.satisfaction}</td>`;
        tb.appendChild(tr);
      }
      const last = state.rows[state.rows.length-1];
      const metric = state.params.metric;
      const metricVal = metric==='profit'? last.profit : (metric==='satisfaction'? last.satisfaction : (last.demand>0? Math.round((last.revenue/last.demand - state.params.unitCost)*10)/10 : 0));
      tf.innerHTML = `Primary metric <span class="tag">${metric}</span> current value: <b>${metric==='profit'? fmt(metricVal): metricVal}</b>.  Rounds completed: ${state.rows.length}/${state.maxRounds}.`;
    }

    function fmt(n){return '$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}
    function fmtPct(n){return (n>0?'+':'')+n.toFixed(0)+'%';}

    function exportCSV(){
      if(state.rows.length===0) return;
      const headers=['round','delta_price_pct','marketing','training','event','demand','price','revenue','cost','profit','satisfaction'];
      const lines=[headers.join(',')].concat(state.rows.map(r=>[r.round,r.dPrice,r.mSpend,r.tSpend,`"${r.event}"`,r.demand,r.price,r.revenue,r.cost,r.profit,r.satisfaction].join(',')));
      const blob=new Blob([lines.join('\n')],{type:'text/csv'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);a.download='olivetonomics_results.csv';a.click();
    }

    function copyReport(){
      if(state.rows.length===0) return;
      const first=state.rows[0], last=state.rows[state.rows.length-1];
      const m=state.params.metric;
      const deltaProfit=(last.profit-first.profit).toFixed(2);
      const text=`Value hypothesis: ${state.params.hypo}\nPrimary metric: ${m}\nSummary: After ${state.rows.length} rounds, profit changed by ${deltaProfit}, satisfaction reached ${last.satisfaction}. Decision: ${decision(m,first,last)}.`;
      navigator.clipboard.writeText(text);
      alert('Summary copied to clipboard.');
    }

    function decision(m,first,last){
      if(m==='profit') return last.profit>first.profit?'Persevere':'Pivot';
      if(m==='satisfaction') return last.satisfaction>first.satisfaction?'Persevere':'Pivot';
      return last.revenue>first.revenue?'Persevere':'Pivot';
    }
  </script>
</body>
</html>
